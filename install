#!/usr/bin/env zsh

if [ ! -d ~/.oh-my-zsh ]; then
  curl -L https://github.com/robbyrussell/oh-my-zsh/raw/master/tools/install.sh | sh
fi

cd `dirname $0`
DOTFILES=$(pwd)

echo "export DOTFILES=${DOTFILES}" > ~/.dotfiles
cat ~/.zshrc | grep "\.dotfiles" || echo ". ${HOME}/.dotfiles" > ~/.zshrc
cat ~/.zshrc | grep "DOTFILES/zshrc" || echo 'source $DOTFILES/zshrc' >> ~/.zshrc
[ $USER = key ] && cat ~/.zshrc | grep 'DOTFILES/zshrc.key' || echo 'source $DOTFILES/zshrc.key' >> ~/.zshrc
cat ~/.gitconfig | grep include || echo "[include]\n\tpath = ${DOTFILES}/gitconfig" >> ~/.gitconfig
[ -f ~/.gitignore ] || cp $DOTFILES/gitignore ~/.gitignore

source ~/.zshrc

if [ ! -f ~/.vim/autoload/plug.vim ]; then
  curl -fLo ~/.vim/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
  vim +PlugInstall +qa
fi

[ -d ~/.config/nvim ] || mkdir -p ~/.config/nvim
cat ~/.config/nvim/init.vim | grep $DOTFILES/neo.vim || echo "source ${DOTFILES}/neo.vim" > ~/.config/nvim/init.vim

if uname | grep Darwin > /dev/null 2>&1; then
  git clone https://github.com/kosmatov/sleepwatcher-wezterm $DOTFILES/sleepwatcher-wezterm
  make -C $DOTFILES/sleepwatcher-wezterm install
  git clone https://github.com/myshov/xkbswitch-macosx $DOTFILES/xkbswitch-macosx
  ln -s $DOTFILES/wezterm.lua ~/.wezterm.lua
end
